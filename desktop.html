<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BTC Dashboard — 24h · 8h · 1h · 10m</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<style>
  :root{
    --bg:#0e0f13;--panel:#151823;--panel-2:#10131b;--text:#e5e7eb;--muted:#9aa3b2;
    --accent:#4da3ff;--up:#16c784;--down:#ff4d4d;--gap:16px;--radius:16px;
  }
  *{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);
    font:14px/1.45 Inter,ui-sans-serif,system-ui}
  .wrap{max-width:1720px;margin:20px auto 40px;padding:0 16px}
  header{display:flex;justify-content:space-between;margin-bottom:14px}
  header h1{margin:0;font-size:18px;font-weight:700}
  header .sub{font-size:12px;color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:var(--gap)}
  .col{background:linear-gradient(180deg,var(--panel)0%,var(--panel-2)100%);
       border-radius:var(--radius);padding:12px;display:flex;flex-direction:column;
       box-shadow:0 6px 18px rgba(0,0,0,.35);}
  .title{display:flex;justify-content:space-between}
  .tf{color:var(--muted);font-weight:700;font-size:12px}
  .price{font-weight:700}
  .chartCard{background:rgba(255,255,255,.02);border-radius:12px;height:200px;margin-top:8px}
  .volumeCard{background:rgba(255,255,255,.02);border-radius:12px;height:110px;margin-top:6px}
  @media(max-width:1280px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:740px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>BTC Overview</h1>
    <div class="sub" id="status">Loading data…</div>
  </header>
  <section class="grid" id="dashboard"></section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const PRODUCT_ID="BTC-USD";
const REST_URL=`https://api.exchange.coinbase.com/products/${PRODUCT_ID}/ticker`;
const TF=[
 {key:'24h',label:'24 HOURS',win:24*60*60e3,sample:3e4},
 {key:'8h',label:'8 HOURS',win:8*60*60e3,sample:15e3},
 {key:'1h',label:'1 HOUR',win:60*60e3,sample:5e3},
 {key:'10m',label:'10 MIN',win:10*60e3,sample:2e3}
];
const dash=document.getElementById('dashboard');
dash.innerHTML=TF.map(t=>`
<div class="col">
 <div class="title"><div class="tf">${t.label}</div><div class="price" id="p-${t.key}">$—</div></div>
 <div class="chartCard"><canvas id="c-${t.key}"></canvas></div>
 <div class="volumeCard"><canvas id="v-${t.key}"></canvas></div>
</div>`).join('');

const s={},getVar=v=>getComputedStyle(document.documentElement).getPropertyValue(v).trim();
TF.forEach(t=>s[t.key]={arr:[],tLast:0,pc:new Chart(document.getElementById(`c-${t.key}`).getContext('2d'),{
 type:'line',data:{labels:[],datasets:[{data:[],borderColor:getVar('--accent')||'#4da3ff',borderWidth:2,fill:false,tension:0}]},
 options:{responsive:true,maintainAspectRatio:false,animation:{duration:0},
  plugins:{legend:{display:false},tooltip:{mode:'index',intersect:false}},
  scales:{x:{ticks:{display:false},grid:{display:false}},y:{ticks:{color:'#7f8796'},grid:{color:'rgba(255,255,255,.05)'}}}}}),
 vc:new Chart(document.getElementById(`v-${t.key}`).getContext('2d'),{
 type:'bar',data:{labels:[],datasets:[{data:[],backgroundColor:[]}]},
 options:{responsive:true,maintainAspectRatio:false,animation:{duration:0},
  plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#7f8796'}},y:{ticks:{display:false}}}}})});

let lastP=65000,lastV=1;
function updateAll(p,v){
 lastP=p;lastV=v;
 TF.forEach(t=>{
  const now=Date.now(),b=s[t.key];
  b.arr=b.arr.filter(pt=>pt.t>=now-t.win);
  if(now-b.tLast>=t.sample){b.arr.push({t:now,price:p,vol:v});b.tLast=now;}
  const lbl=b.arr.map(pt=>new Date(pt.t).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}));
  const pr=b.arr.map(pt=>pt.price);
  b.pc.data.labels=lbl;b.pc.data.datasets[0].data=pr;b.pc.update('none');
  // volume
  const bins=12,w=t.win/bins,start=now-t.win;
  const ag=Array.from({length:bins},(_,i)=>({vol:0,first:null,last:null,start:start+i*w}));
  for(const pt of b.arr){const i=Math.min(bins-1,Math.floor((pt.t-start)/w));const bin=ag[i];bin.vol+=pt.vol;if(bin.first==null)bin.first=pt.price;bin.last=pt.price;}
  b.vc.data.labels=ag.map(x=>new Date(x.start).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}));
  b.vc.data.datasets[0].data=ag.map(x=>x.vol);
  b.vc.data.datasets[0].backgroundColor=ag.map(x=>!x.first?'#bbb':(x.last>=x.first?getVar('--up'):getVar('--down')));
  b.vc.update('none');
  const el=document.getElementById(`p-${t.key}`);el.textContent='$'+p.toLocaleString(undefined,{maximumFractionDigits:2});
  el.style.color=p>=lastP?getVar('--up'):getVar('--down');
 });
}

async function poll(){
 try{
  const r=await fetch(REST_URL,{headers:{Accept:'application/json'}});
  const j=await r.json();
  const p=parseFloat(j.price||j.last||j.ask||j.bid);
  const v=parseFloat(j.size||j.volume||0.2)||0.2;
  if(isFinite(p)){updateAll(p,v);document.getElementById('status').textContent='Live data';}
  else throw new Error();
 }catch{document.getElementById('status').textContent='Mock data';mock();}
}
function mock(){
 const n=lastP+(Math.random()-0.5)*40;updateAll(n,Math.random()*2);}

setInterval(poll,2000);
poll();
</script>
</body>
</html>
