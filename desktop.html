<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Coinbase Stalker — Desktop Multi-Range</title>
<style>
  :root{
    --bg:#0b0c0e; --panel:#101215; --panel2:#0d0f12;
    --text:#e8f7f2; --muted:#a9b6b1;
    --up:#2dd4bf; --down:#f59e0b;
    --grid:rgba(255,255,255,.08); --grid2:rgba(255,255,255,.06);
    --pill-bg:rgba(0,0,0,.78); --pill-bd:rgba(255,255,255,.22);
    --glow:0 0 0 1px rgba(255,255,255,.05), 0 16px 40px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font:14px/1.4 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1680px;margin:0 auto;padding:16px}
  h1{margin:0 0 14px;font-size:26px;letter-spacing:.2px}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
  .card{background:var(--panel);border-radius:14px;box-shadow:var(--glow);padding:10px;position:relative}
  .titleRow{display:flex;align-items:center;gap:10px;margin-bottom:6px}
  .title{font-weight:800;opacity:.95;text-transform:uppercase;letter-spacing:.3px;font-size:12px}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:5px 9px;border-radius:999px;background:var(--pill-bg);border:1px solid var(--pill-bd);font-size:12px;white-space:nowrap}
  canvas{display:block;width:100%;background:var(--panel2);border-radius:12px}
  .c-price{height:180px}
  .c-gauge{height:20px;margin-top:6px}
  .c-vol{height:150px;margin-top:8px}
  .c-tops{height:240px;margin-top:10px}
  .legend{position:absolute;right:12px;top:8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Coinbase Stalker — Desktop Multi-Range</h1>

  <div class="grid">
    <section class="card" id="p10">
      <div class="titleRow"><span class="title">10 minutes (locked)</span><span class="pill" id="p10Live">Live</span></div>
      <canvas class="c-price"></canvas>
      <canvas class="c-gauge"></canvas>
      <canvas class="c-vol"></canvas>
      <canvas class="c-tops"></canvas>
      <span class="pill legend" id="p10Max">max ₿—</span>
    </section>

    <section class="card" id="p60">
      <div class="titleRow"><span class="title">1 hour</span><span class="pill">Prefilled</span></div>
      <canvas class="c-price"></canvas>
      <canvas class="c-gauge"></canvas>
      <canvas class="c-vol"></canvas>
      <canvas class="c-tops"></canvas>
      <span class="pill legend" id="p60Max">max ₿—</span>
    </section>

    <section class="card" id="p480">
      <div class="titleRow"><span class="title">8 hours</span><span class="pill">Prefilled</span></div>
      <canvas class="c-price"></canvas>
      <canvas class="c-gauge"></canvas>
      <canvas class="c-vol"></canvas>
      <canvas class="c-tops"></canvas>
      <span class="pill legend" id="p480Max">max ₿—</span>
    </section>

    <section class="card" id="p1440">
      <div class="titleRow"><span class="title">24 hours</span><span class="pill">Prefilled</span></div>
      <canvas class="c-price"></canvas>
      <canvas class="c-gauge"></canvas>
      <canvas class="c-vol"></canvas>
      <canvas class="c-tops"></canvas>
      <span class="pill legend" id="p1440Max">max ₿—</span>
    </section>
  </div>
</div>

<script>
const fmtUSD=(v,fd=0)=>new Intl.NumberFormat(undefined,{style:'currency',currency:'USD',maximumFractionDigits:fd}).format(v);
function sizeCanvas(c){const dpr=Math.min(3,window.devicePixelRatio||1);c.width=c.clientWidth*dpr;c.height=c.clientHeight*dpr;const x=c.getContext('2d');x.setTransform(dpr,0,0,dpr,0,0);return x;}
function rr(ctx,x,y,w,h,r,fill=true,stroke=false){ctx.beginPath();ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);if(fill)ctx.fill();if(stroke)ctx.stroke();}

class Panel{
  constructor(root,barsWanted){
    const [price,gauge,vol,tops]=root.querySelectorAll('canvas');
    this.cPrice=price;this.cGauge=gauge;this.cVol=vol;this.cTops=tops;
    this.maxPill=root.querySelector('.legend');
    const cs=getComputedStyle(document.body);
    this.colors={up:cs.getPropertyValue('--up').trim(),down:cs.getPropertyValue('--down').trim(),grid:cs.getPropertyValue('--grid').trim(),grid2:cs.getPropertyValue('--grid2').trim()};
    this.barsWanted=barsWanted;this.priceBars=[];this.volBars=[];this.tops=[];
  }

  draw(){this.drawPrice();this.drawGauge();this.drawVol();this.drawTops();}

  drawPrice(){
    const ctx=sizeCanvas(this.cPrice),w=this.cPrice.clientWidth,h=this.cPrice.clientHeight;
    ctx.clearRect(0,0,w,h);ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--panel2');ctx.fillRect(0,0,w,h);
    const data=this.priceBars.slice(-this.barsWanted);if(data.length<2)return;
    const padX=14,padY=14,min=Math.min(...data.map(d=>d.close)),max=Math.max(...data.map(d=>d.close)),range=(max-min)||1,avg=data.reduce((a,d)=>a+d.close,0)/data.length;
    ctx.strokeStyle=this.colors.grid;for(let i=1;i<=3;i++){const y=padY+(h-2*padY)*(i/4*(4/3));ctx.beginPath();ctx.moveTo(padX,y);ctx.lineTo(w-padX,y);ctx.stroke();}
    const yAvg=padY+(h-2*padY)*(1-(avg-min)/range);ctx.setLineDash([6,6]);ctx.strokeStyle='rgba(255,255,255,.35)';ctx.beginPath();ctx.moveTo(padX,yAvg);ctx.lineTo(w-padX,yAvg);ctx.stroke();ctx.setLineDash([]);
    const usableW=w-2*padX,dx=usableW/(data.length-1),pts=data.map((d,i)=>({x:padX+i*dx,y:padY+(h-2*padY)*(1-(d.close-min)/range)}));
    // straight segments
    ctx.lineWidth=2.25;ctx.lineJoin='round';ctx.lineCap='round';
    ctx.strokeStyle=this.colors.up;ctx.beginPath();ctx.moveTo(pts[0].x,pts[0].y);
    for(let i=1;i<pts.length;i++){ctx.lineTo(pts[i].x,pts[i].y);}ctx.stroke();
    ctx.save();ctx.beginPath();ctx.rect(padX,yAvg,w-2*padX,h-yAvg-padY);ctx.clip();
    ctx.strokeStyle=this.colors.down;ctx.beginPath();ctx.moveTo(pts[0].x,pts[0].y);
    for(let i=1;i<pts.length;i++){ctx.lineTo(pts[i].x,pts[i].y);}ctx.stroke();ctx.restore();
    const last=data[data.length-1].close,txt=fmtUSD(last,0);ctx.font='12px system-ui';ctx.textBaseline='middle';
    const tw=ctx.measureText(txt).width+16,th=20,lastPt=pts[pts.length-1];
    const bx=Math.min(w-tw-8,Math.max(8,lastPt.x-tw/2)),by=Math.max(8,lastPt.y-th-6);
    ctx.fillStyle='rgba(0,0,0,.8)';ctx.strokeStyle='rgba(255,255,255,.25)';rr(ctx,bx,by,tw,th,10,true,true);ctx.fillStyle='#fff';ctx.fillText(txt,bx+8,by+th/2);
  }

  drawGauge(){
    const ctx=sizeCanvas(this.cGauge),w=this.cGauge.clientWidth,h=this.cGauge.clientHeight;
    ctx.clearRect(0,0,w,h);
    const buy=this.volBars.reduce((a,b)=>a+(+b.buy||0),0),sell=this.volBars.reduce((a,b)=>a+(+b.sell||0),0),tot=buy+sell,pos=tot?(buy/tot):0.5,r=h/2;
    const g=ctx.createLinearGradient(0,0,w,0);g.addColorStop(0,this.colors.down);g.addColorStop(pos,this.colors.down);g.addColorStop(pos,this.colors.up);g.addColorStop(1,this.colors.up);
    ctx.fillStyle=g;rr(ctx,1,1,w-2,h-2,r-1,true,false);
    const x=Math.round(w*pos);ctx.fillStyle='#fff';ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x-6,h);ctx.lineTo(x+6,h);ctx.closePath();ctx.fill();
  }

  drawVol(){
    const ctx=sizeCanvas(this.cVol),w=this.cVol.clientWidth,h=this.cVol.clientHeight;ctx.clearRect(0,0,w,h);
    ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--panel2');ctx.fillRect(0,0,w,h);
    const bins=this.volBars.slice(-this.barsWanted);if(!bins.length){this.maxPill.textContent='max ₿—';return;}
    const padX=14,padTop=10,padBottom=24,chartH=h-padTop-padBottom,step=(w-2*padX)/bins.length,barW=step*0.62;ctx.strokeStyle=this.colors.grid2;
    for(let i=1;i<=2;i++){const y=padTop+chartH*(i/3*(3/2));ctx.beginPath();ctx.moveTo(padX-6,y);ctx.lineTo(w-padX+6,y);ctx.stroke();}
    const totals=bins.map(b=>(+b.buy||0)+(+b.sell||0)),max=Math.max(0.01,...totals);this.maxPill.textContent=`max ₿${max.toFixed(2)}`;
    const up=this.colors.up,dn=this.colors.down;
    for(let i=0;i<bins.length;i++){const b=bins[i],tot=totals[i],hT=(tot/max)*(chartH*0.85),yB=padTop+chartH,xC=padX+i*step+step/2,buyH=tot?(b.buy/tot)*hT:0,sellH=hT-buyH;
      ctx.fillStyle=dn;ctx.fillRect(xC-barW/2,yB-sellH,barW,sellH);
      ctx.fillStyle=up;ctx.fillRect(xC-barW/2,yB-sellH-buyH,barW,buyH);}
  }

  drawTops(){
    const ctx=sizeCanvas(this.cTops),w=this.cTops.clientWidth,h=this.cTops.clientHeight;
    ctx.clearRect(0,0,w,h);ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--panel2');ctx.fillRect(0,0,w,h);
    const buys=this.tops.filter(t=>t.side==='buy').slice(0,12),sells=this.tops.filter(t=>t.side==='sell').slice(0,12);
    const rows=Math.max(buys.length,sells.length);if(!rows)return;
    const padX=10,padY=10,gap=6,rowH=18,mid=Math.floor(w/2),up=this.colors.up,dn=this.colors.down;
    const maxUSD=Math.max(1,...buys.map(b=>b.usd),...sells.map(s=>s.usd)),leftMax=mid-padX-8,rightMax=w-mid-padX-8;
    ctx.strokeStyle='rgba(255,255,255,.16)';ctx.beginPath();ctx.moveTo(mid+.5,padY);ctx.lineTo(mid+.5,h-padY);ctx.stroke();
    ctx.font='11px system-ui';ctx.textBaseline='middle';
    for(let i=0;i<rows;i++){const y=padY+i*(rowH+gap)+rowH/2,s=sells[i],b=buys[i];
      if(s){const f=Math.min(1,s.usd/maxUSD),bw=Math.max(4,f*leftMax);ctx.fillStyle=dn;rr(ctx,mid-bw,y-rowH/2,bw,rowH,6,true,false);}
      if(b){const f=Math.min(1,b.usd/maxUSD),bw=Math.max(4,f*rightMax);ctx.fillStyle=up;rr(ctx,mid,y-rowH/2,bw,rowH,6,true,false);}
    }
  }
}

/* ==== create panels ==== */
const p10=new Panel(document.getElementById('p10'),10),
      p60=new Panel(document.getElementById('p60'),12),
      p480=new Panel(document.getElementById('p480'),12),
      p1440=new Panel(document.getElementById('p1440'),12);

/* ==== sample prefill data ==== */
async function fetchCandles(g){const url=`https://api.exchange.coinbase.com/products/BTC-USD/candles?granularity=${g}`;const r=await fetch(url,{headers:{accept:'application/json'}});const a=await r.json();return Array.isArray(a)?a.slice(0,24).reverse().map(d=>({t:d[0]*1000,close:d[4],vol:d[5]})):[];}
async function loadPrefill(p,gran){try{const d=await fetchCandles(gran);p.priceBars=d.map(x=>({t:x.t,close:x.close}));p.volBars=d.map(x=>({buy:x.vol/2,sell:x.vol/2,label:''}));p.tops=d.map(x=>({usd:x.close*x.vol/2,size:x.vol/2,side:Math.random()<0.5?'buy':'sell'}));p.draw();}catch(e){console.error(e);}}
loadPrefill(p60,300);loadPrefill(p480,1800);loadPrefill(p1440,3600);

/* ==== fake 10m stream ==== */
function mock10(){const now=Date.now();const price=110000+Math.random()*200-100;const size=Math.random()*0.3;const side=Math.random()<0.5?'buy':'sell';
  if(!p10._mins)p10._mins=[];const mStart=now-(now%60000);let m=p10._mins.find(x=>x.t===mStart);
  if(!m){p10._mins=p10._mins.filter(x=>x.t>=mStart-9*60000);m={t:mStart,close:price,buy:0,sell:0};p10._mins.push(m);p10._mins.sort((a,b)=>a.t-b.t);}
  m.close=price;if(side==='sell')m.sell+=size;else m.buy+=size;
  p10.priceBars=p10._mins.map(x=>({t:x.t,close:x.close}));
  p10.volBars=p10._mins.map(x=>({buy:x.buy,sell:x.sell,label:new Date(x.t).toLocaleTimeString([],{minute:'2-digit'})}));
}
setInterval(mock10,2000);

/* ==== loop ==== */
function frame(){p10.draw();p60.draw();p480.draw();p1440.draw();requestAnimationFrame(frame);}frame();
</script>
</body>
</html>