<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BTC Overview — v1.7.0</title>
<style>
  :root{
    --bg:#0e0f13; --panel:#151823; --panel-2:#10131b; --text:#e5e7eb; --muted:#9aa3b2;
    --accent:#4da3ff; --up:#16c784; --down:#ff4d4d;
    --gap:10px; --radius:8px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 Inter,ui-sans-serif,system-ui;overflow-x:hidden}
  .wrap{max-width:1900px;margin:16px auto 28px;padding:0 24px}

  header{display:grid;grid-template-columns:1fr minmax(320px,680px) 1fr;align-items:center;gap:8px;margin-bottom:10px}
  .metaLeft,.metaRight{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
  .metaRight{justify-self:end}
  .chip{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid #27324a;background:#0b1220;color:#cbd5e1;white-space:nowrap}
  .badge{font-size:12px;color:var(--muted)}
  .pane{background:linear-gradient(180deg,var(--panel) 0%,var(--panel-2) 100%);border-radius:10px;padding:6px 10px;display:grid;grid-template-columns:auto 1fr auto;align-items:center;box-shadow:0 3px 10px rgba(0,0,0,.24)}
  .pane label{color:#cbd5e1;font-weight:700;margin-right:10px}
  #headerPrice{justify-self:center;font-weight:900;font-size:clamp(20px,3.2vw,34px);letter-spacing:.2px;transition:color .18s,filter .18s}
  #headerPrice.up{color:var(--up);filter:drop-shadow(0 0 6px rgba(22,199,132,.22))}
  #headerPrice.down{color:var(--down);filter:drop-shadow(0 0 6px rgba(255,77,77,.22))}
  #headerClock{justify-self:end;color:var(--muted);font-weight:600;font-variant-numeric:tabular-nums}

  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(380px,1fr));gap:var(--gap);justify-content:center;align-items:start}
  .col{background:linear-gradient(180deg,var(--panel) 0%,var(--panel-2) 100%);border-radius:var(--radius);padding:8px;display:flex;flex-direction:column;box-shadow:0 3px 12px rgba(0,0,0,.25)}
  .title{display:flex;justify-content:space-between;align-items:center}
  .tf{color:var(--muted);font-weight:800;font-size:12px}
  .topbar{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
  .pill{font-size:12px;padding:3px 10px;border-radius:999px;border:1px solid #27324a;background:#0b1220;color:#cbd5e1;white-space:nowrap}
  .pill.up{background:var(--up);border-color:transparent;color:#09130e}
  .pill.down{background:var(--down);border-color:transparent;color:#140808}
  .pill.muted{background:#0b1220;color:#cbd5e1;border:1px solid #27324a}

  .chartCard{background:rgba(255,255,255,.02);border-radius:8px;height:200px;margin-top:6px}
  .deltaPill{text-align:center;margin:4px auto 0;padding:4px 0}
  .volumeCard{background:rgba(255,255,255,.02);border-radius:8px;height:165px;margin-top:4px}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
<script defer>
window.addEventListener('DOMContentLoaded', () => {
  const APP_VERSION='v1.7.0';
  const TF = [
    { key:'24h', label:'24 HOURS', win:24*60*60*1000, sample:30000, bin:12 },
    { key:'8h',  label:'8 HOURS',  win: 8*60*60*1000, sample:15000, bin:12 },
    { key:'1h',  label:'1 HOUR',   win: 1*60*60*1000, sample: 5000, bin:12 },
    { key:'10m', label:'10 MIN',   win:10*60*1000,    sample: 2000, bin:12 }
  ];

  const dash = document.getElementById('dashboard');
  const histEl = document.getElementById('histStatus');
  const liveEl = document.getElementById('liveStatus');
  const headPrice = document.getElementById('headerPrice');
  const headClock = document.getElementById('headerClock');
  document.getElementById('ver').textContent = APP_VERSION;

  dash.innerHTML = TF.map(t=>`
    <div class="col">
      <div class="title">
        <div class="tf">${t.label}</div>
        <div class="topbar">
          <span class="pill muted" id="tfc-${t.key}">—</span>
          <span class="pill muted" id="hlc-${t.key}">H/L — / —</span>
          <span class="pill muted" id="volc-${t.key}">Vol —</span>
        </div>
      </div>
      <div class="chartCard"><canvas id="c-${t.key}"></canvas></div>
      <div class="deltaPill"><span class="pill muted" id="deltac-${t.key}">—</span></div>
      <div class="volumeCard"><canvas id="v-${t.key}"></canvas></div>
    </div>
  `).join('');

  const cssVar = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  const state = {};
  let lastPriceGlobal=65000;

  function makeLineChart(ctx,key){
    const is10=key==='10m';
    return new Chart(ctx,{
      type:'line',
      data:{labels:[],datasets:[{data:[],borderColor:cssVar('--accent'),borderWidth:is10?3:2,pointRadius:0,tension:is10?0.25:0,fill:is10}]},
      options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{display:false},y:{ticks:{color:'#7f8796'}}}}
    });
  }
  function makeBarChart(ctx){
    return new Chart(ctx,{type:'bar',data:{labels:[],datasets:[{data:[],backgroundColor:[]}]},
      options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#7f8796'}},y:{display:false}}}});
  }
  const fmtUSD=n=>'$'+(n??0).toLocaleString(undefined,{maximumFractionDigits:2});
  const fmtVOL=n=>(n??0).toLocaleString(undefined,{maximumFractionDigits:3});
  function computeTrendColor(key){
    const a=state[key].arr;if(a.length<2)return cssVar('--accent');return (a[a.length-1].price>=a[0].price)?cssVar('--up'):cssVar('--down');
  }

  function redraw(key){
    const b=state[key],now=Date.now(),tf=TF.find(x=>x.key===key);
    b.arr=b.arr.filter(pt=>pt.t>=now-tf.win);
    const labels=b.arr.map(pt=>new Date(pt.t).toLocaleTimeString());
    const prices=b.arr.map(pt=>pt.price),vols=b.arr.map(pt=>pt.vol||0);
    const pc=b.pc; pc.data.labels=labels; pc.data.datasets[0].data=prices; pc.update('none');
    const vc=b.vc; vc.data.labels=labels; vc.data.datasets[0].data=vols;
    vc.data.datasets[0].backgroundColor=vols.map((_,i)=>i>0&&(prices[i]>=prices[0]?cssVar('--up'):cssVar('--down'))); vc.update('none');
    updateTopbar(key,prices,vols);
  }

  function updateTopbar(key,prices,vols){
    const tfPill=document.getElementById(`tfc-${key}`),
      hlPill=document.getElementById(`hlc-${key}`),
      volPill=document.getElementById(`volc-${key}`),
      deltaPill=document.getElementById(`deltac-${key}`);
    if(!prices.length)return;
    const first=prices[0],last=prices[prices.length-1],delta=last-first,pct=(delta/first)*100,arrow=delta>=0?'+':'–';
    const hi=Math.max(...prices),lo=Math.min(...prices);
    const volSum=vols.reduce((s,v)=>s+v,0);
    tfPill.textContent=`${arrow}${fmtUSD(Math.abs(delta))} (${Math.abs(pct).toFixed(2)}%)`;
    tfPill.className='pill '+(delta>=0?'up':'down');
    hlPill.textContent=`H/L ${fmtUSD(hi)} / ${fmtUSD(lo)}`;
    volPill.textContent=`Vol ${fmtVOL(volSum)}`;
    deltaPill.textContent=`${arrow}${Math.abs(pct).toFixed(2)}%`;
    deltaPill.className='pill '+(delta>=0?'up':'down');
  }

  for(const t of TF){
    state[t.key]={arr:[],pc:makeLineChart(document.getElementById('c-'+t.key).getContext('2d'),t.key),vc:makeBarChart(document.getElementById('v-'+t.key).getContext('2d'))};
    // preload mock so UI fills
    let p=lastPriceGlobal;const now=Date.now();
    for(let i=0;i<12;i++){p+=(Math.random()-0.5)*20;state[t.key].arr.push({t:now-(12-i)*10000,price:p,vol:Math.random()*2});}
    redraw(t.key);
  }

  // Header price + clock
  let lastHeader=null;
  function setHeaderPrice(p){headPrice.classList.remove('up','down');headPrice.textContent=fmtUSD(p);
    if(lastHeader!=null){if(p>lastHeader)headPrice.classList.add('up');else if(p<lastHeader)headPrice.classList.add('down');}
    lastHeader=p;}
  setInterval(()=>headClock.textContent=new Date().toLocaleTimeString(),1000);

  // Simple live mock update for demo
  setInterval(()=>{
    const p=lastPriceGlobal+(Math.random()-0.5)*50;lastPriceGlobal=p;setHeaderPrice(p);
    for(const t of TF){const b=state[t.key];b.arr.push({t:Date.now(),price:p,vol:Math.random()*2});redraw(t.key);}
    liveEl.textContent='Live: mock · '+APP_VERSION;
  },2000);
});
</script>
</head>
<body>
<div class="wrap">
  <header>
    <div class="metaLeft">
      <span class="chip" id="ver">v1.7.0</span>
      <span class="badge" id="histStatus">History: loading…</span>
      <span class="badge" id="liveStatus">Live: starting…</span>
    </div>
    <div class="pane">
      <label>BTC/USD</label>
      <div id="headerPrice">$—</div>
      <div id="headerClock">—:—:—</div>
    </div>
    <div class="metaRight"><span class="chip" id="jsStatus" style="border-color:#2e7d32;color:#b7f5c8">JS: running</span></div>
  </header>
  <section class="grid" id="dashboard"></section>
</div>
</body>
</html>