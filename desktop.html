<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coinbase Stalker — Desktop Multi-Range</title>
<style>
  :root{
    --bg:#0a0a0a; --panel:#111; --panel-2:#0d0d0d;
    --text:#e9fef7; --muted:#c8d6cf;
    --up:#2dd4bf; --down:#f59e0b;
    --grid:rgba(255,255,255,.12); --grid-2:rgba(255,255,255,.10);
    --pill-bg:rgba(0,0,0,.80); --pill-bd:rgba(255,255,255,.25);
    --glow:0 0 0 1px rgba(255,255,255,.06), 0 18px 40px rgba(0,0,0,.45);
  }

  *{box-sizing:border-box}
  html,body{
    height:100%; margin:0;
    background:var(--bg); color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;
  }

  .wrap{padding:8px 10px 40px; max-width:100%; margin:0 auto;}
  h1{margin:6px 4px 12px; font-size:22px; letter-spacing:.3px; opacity:.95}

  .grid{
    display:grid;
    grid-template-columns:repeat(4, minmax(280px, 1fr));
    gap:10px;
  }

  .card{
    background:var(--panel);
    border-radius:14px;
    box-shadow:var(--glow);
    padding:10px;
    display:flex;
    flex-direction:column;
    min-height:640px;
  }

  .titleRow{display:flex; align-items:center; gap:8px; margin-bottom:6px}
  .ttl{font-weight:800; font-size:12px; letter-spacing:.6px; text-transform:uppercase; opacity:.9}
  .pill{display:inline-flex; align-items:center; gap:8px; padding:5px 9px;
        border-radius:999px; background:var(--pill-bg); border:1px solid var(--pill-bd);
        font-size:11px; white-space:nowrap; color:#fff;}

  .chart{height:240px; border-radius:12px; background:var(--panel-2); margin-bottom:8px}
  .gaugeRow{display:flex; align-items:center; gap:10px; margin:4px 0}
  .gauge{height:24px; border-radius:999px; background:transparent; box-shadow:inset 0 0 0 1px rgba(255,255,255,.14); flex:1}
  .gLbl{font-size:12px; opacity:.9}
  .gLbl.buy{color:var(--up)} .gLbl.sell{color:var(--down)}
  .needle{position:absolute; top:3px; width:0; height:0;
    border-left:7px solid transparent; border-right:7px solid transparent;
    border-top:10px solid #fff; filter:drop-shadow(0 2px 2px rgba(0,0,0,.35))}
  .needleWrap{position:relative; flex:1}

  .vol{height:170px; border-radius:12px; background:var(--panel-2); margin-top:6px}
  .tops{flex:1; border-radius:12px; background:var(--panel-2); margin-top:8px; padding:8px}
  .topsGrid{display:grid; grid-template-columns:1fr 1fr; gap:10px; height:100%}
  .topsCol{overflow:auto; border:1px solid rgba(255,255,255,.12); border-radius:10px; padding:6px}
  .topsCol.buy{background:color-mix(in oklab, var(--up) 12%, transparent)}
  .topsCol.sell{background:color-mix(in oklab, var(--down) 12%, transparent)}
  .topsCol h4{margin:2px 2px 6px; font-size:11px; letter-spacing:.5px; text-transform:uppercase}
  .item{display:flex; justify-content:space-between; gap:8px; padding:6px 8px; border-radius:8px; background:rgba(0,0,0,.18); margin:4px 0; font-variant-numeric:tabular-nums}
  .usd{font-weight:800}
  .btc,.tm{opacity:.85}

  .conn{position:fixed; left:10px; bottom:10px; z-index:40}
  canvas{display:block; width:100%; height:100%}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Coinbase Stalker — Desktop Multi-Range</h1>
    <div class="grid" id="grid"></div>
    <div class="pill conn" id="connPill">Connecting…</div>
  </div>

<script>
const fmtUSD=(v,fd=0)=>new Intl.NumberFormat(undefined,{style:'currency',currency:'USD',maximumFractionDigits:fd}).format(v);
function sizeCanvas(c){
  const dpr=Math.min(3,window.devicePixelRatio||1);
  c.width=c.clientWidth*dpr; c.height=c.clientHeight*dpr;
  const ctx=c.getContext('2d'); ctx.setTransform(dpr,0,0,dpr,0,0); return ctx;
}
function roundRect(ctx,x,y,w,h,r,fill=true,stroke=false){
  ctx.beginPath();ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);
  if(fill)ctx.fill();if(stroke)ctx.stroke();
}

/* shared trade state */
const MS={M10:600000,H1:3600000,H8:8*3600000,D1:24*3600000};
let trades=[];

/* range panel class (omitted here for brevity — same as above) */
class RangePanel {
  constructor(parent,label,span){ /* ... same as above ... */ }
  /* all draw methods same as previous message */
}

/* build panels */
const grid=document.getElementById('grid');
const panels=[
  new RangePanel(grid,'10 MIN',MS.M10),
  new RangePanel(grid,'1 HR',MS.H1),
  new RangePanel(grid,'8 HR',MS.H8),
  new RangePanel(grid,'24 HR',MS.D1)
];

/* websocket feed */
const connPill=document.getElementById('connPill');
let ws,recon;
function startWS(){
  try{ws&&ws.close();}catch{}
  ws=new WebSocket('wss://ws-feed.exchange.coinbase.com');
  ws.onopen=()=>{
    ws.send(JSON.stringify({type:'subscribe',product_ids:['BTC-USD'],channels:['matches']}));
    connPill.textContent='Live';
    connPill.style.background='rgba(0,128,0,.6)';
  };
  ws.onmessage=(e)=>{
    try{
      const m=JSON.parse(e.data);
      if(m.type==='match' && m.product_id==='BTC-USD'){
        trades.push({
          t:new Date(m.time).getTime(),
          price:+m.price,
          size:+m.size,
          side:m.side
        });
      }
    }catch{}
  };
  ws.onclose=()=>{
    connPill.textContent='Reconnecting…';
    connPill.style.background='rgba(128,0,0,.5)';
    clearTimeout(recon);
    recon=setTimeout(startWS,2000);
  };
  ws.onerror=()=>{ try{ws.close();}catch{} };
}
startWS();

/* frame loop */
function prune(){
  const cutoff=Date.now()-MS.D1;
  trades=trades.filter(t=>t.t>=cutoff);
}
function frame(){
  prune();
  for(const p of panels)p.drawAll();
  requestAnimationFrame(frame);
}
new ResizeObserver(()=>panels.forEach(p=>p.drawAll())).observe(document.body);
requestAnimationFrame(frame);
</script>
</body>
</html>