<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC Charts</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0f172a;
            color: #e2e8f0;
            overflow: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 2fr 2fr;
            gap: 6px;
            padding: 6px;
            height: 100vh;
        }

        .chart-panel {
            background: #1e293b;
            border-radius: 12px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 30px rgba(45, 212, 191, 0.15);
            border: 1px solid rgba(45, 212, 191, 0.1);
        }

        .chart-header {
            font-size: 11px;
            font-weight: bold;
            color: #94a3b8;
            margin-bottom: 4px;
            text-align: center;
            letter-spacing: 2px;
        }

        .price-display {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 3px;
            color: #2dd4bf;
            text-shadow: 0 0 20px rgba(45, 212, 191, 0.3);
        }

        .change-display {
            font-size: 14px;
            text-align: center;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .chart-container {
            flex: 1;
            position: relative;
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .stats-wrapper {
            margin-bottom: 8px;
            padding: 0 5px;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 4px;
        }

        .stats-row-center {
            display: flex;
            justify-content: center;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 8px;
            padding: 0 5px;
            font-size: 12px;
            gap: 10px;
        }

        .stat {
            text-align: center;
            flex: 1;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 11px;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }

        .stat-value {
            color: #e2e8f0;
            font-weight: bold;
            font-size: 14px;
        }

        .up {
            color: #2dd4bf;
        }

        .down {
            color: #f59e0b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chart-panel">
            <div class="chart-header">24 HOURS</div>
            <div class="stats-wrapper">
                <div class="stats-row">
                    <div class="stat">
                        <div class="stat-label">HIGH</div>
                        <div class="stat-value" id="high-24h">-</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">LOW</div>
                        <div class="stat-value" id="low-24h">-</div>
                    </div>
                </div>
                <div class="stats-row-center">
                    <div class="stat">
                        <div class="stat-label">AVG</div>
                        <div class="stat-value" id="avg-24h">-</div>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="chart-24h"></canvas>
            </div>
        </div>

        <div class="chart-panel">
            <div class="chart-header">1 HOUR</div>
            <div class="stats-wrapper">
                <div class="stats-row">
                    <div class="stat">
                        <div class="stat-label">HIGH</div>
                        <div class="stat-value" id="high-1h">-</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">LOW</div>
                        <div class="stat-value" id="low-1h">-</div>
                    </div>
                </div>
                <div class="stats-row-center">
                    <div class="stat">
                        <div class="stat-label">AVG</div>
                        <div class="stat-value" id="avg-1h">-</div>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="chart-1h"></canvas>
            </div>
        </div>

        <div class="chart-panel">
            <div class="chart-header">5 MINUTES</div>
            <div class="price-display" id="price-5m">$--,---</div>
            <div class="change-display" id="change-5m">--</div>
            <div class="chart-container">
                <canvas id="chart-5m"></canvas>
            </div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">HIGH</div>
                    <div class="stat-value" id="high-5m">-</div>
                </div>
                <div class="stat">
                    <div class="stat-label">LOW</div>
                    <div class="stat-value" id="low-5m">-</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const chartConfigs = {
            '24h': { canvasId: 'chart-24h', granularity: 900, points: 96 },  // 15min bars, 96 points = 24 hours
            '1h': { canvasId: 'chart-1h', granularity: 60, points: 60 },     // 1min bars, 60 points = 1 hour
            '5m': { canvasId: 'chart-5m', granularity: 5, points: 60 }       // 5sec bars, 60 points = 5 minutes
        };

        const charts = {};
        const priceData = {};

        // Initialize charts
        Object.keys(chartConfigs).forEach(key => {
            const config = chartConfigs[key];
            const ctx = document.getElementById(config.canvasId).getContext('2d');

            priceData[key] = {
                timestamps: [],
                prices: [],
                volumes: []
            };

            charts[key] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'BTC/USD',
                        data: [],
                        borderColor: '#2dd4bf',
                        backgroundColor: 'rgba(45, 212, 191, 0.1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.1,
                        fill: true
                    }, {
                        label: 'Average',
                        data: [],
                        borderColor: '#94a3b8',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        pointRadius: 0,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        x: { display: false },
                        y: {
                            display: true,
                            grid: {
                                color: 'rgba(148, 163, 184, 0.15)',
                                lineWidth: 1
                            },
                            border: {
                                display: false
                            },
                            ticks: {
                                color: '#64748b',
                                font: {
                                    size: 11,
                                    family: "'Courier New', monospace"
                                },
                                padding: 8
                            }
                        }
                    },
                    interaction: { mode: 'index', intersect: false }
                }
            });
        });

        // Fetch historical data from Coinbase
        async function fetchHistoricalData(timeframe) {
            const config = chartConfigs[timeframe];
            const end = Math.floor(Date.now() / 1000);
            const start = end - (config.granularity * config.points);

            try {
                const response = await fetch(
                    `https://api.exchange.coinbase.com/products/BTC-USD/candles?start=${start}&end=${end}&granularity=${config.granularity}`
                );
                const data = await response.json();

                // Coinbase returns [time, low, high, open, close, volume]
                data.reverse().forEach(candle => {
                    const [time, low, high, open, close, volume] = candle;
                    priceData[timeframe].timestamps.push(time);
                    priceData[timeframe].prices.push(close);
                    priceData[timeframe].volumes.push(volume);
                });

                updateChart(timeframe);
                updateStats(timeframe);
            } catch (error) {
                console.error(`Error fetching ${timeframe} data:`, error);
            }
        }

        function updateChart(timeframe) {
            const data = priceData[timeframe];
            const chart = charts[timeframe];
            const avg = data.prices.reduce((a, b) => a + b, 0) / data.prices.length;

            chart.data.labels = data.timestamps.map(t => new Date(t * 1000).toLocaleTimeString());
            chart.data.datasets[0].data = data.prices;

            // Add average line as horizontal line across all points
            chart.data.datasets[1].data = new Array(data.prices.length).fill(avg);

            // Color based on current vs average
            const currentPrice = data.prices[data.prices.length - 1];
            chart.data.datasets[0].borderColor = currentPrice > avg ? '#2dd4bf' : '#f59e0b';
            chart.data.datasets[0].backgroundColor = currentPrice > avg ?
                'rgba(45, 212, 191, 0.1)' : 'rgba(245, 158, 11, 0.1)';

            chart.update('none');
        }

        function updateStats(timeframe) {
            const data = priceData[timeframe];
            if (data.prices.length === 0) return;

            const currentPrice = data.prices[data.prices.length - 1];
            const startPrice = data.prices[0];
            const high = Math.max(...data.prices);
            const low = Math.min(...data.prices);
            const avg = data.prices.reduce((a, b) => a + b, 0) / data.prices.length;
            const change = ((currentPrice - startPrice) / startPrice) * 100;

            // Only update price display if element exists (for 5m chart)
            const priceEl = document.getElementById(`price-${timeframe}`);
            if (priceEl) {
                priceEl.textContent =
                    `$${currentPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            const changeEl = document.getElementById(`change-${timeframe}`);
            if (changeEl) {
                const changeText = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                changeEl.textContent = changeText;
                changeEl.className = `change-display ${change >= 0 ? 'up' : 'down'}`;
            }

            document.getElementById(`high-${timeframe}`).textContent =
                `$${high.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
            document.getElementById(`low-${timeframe}`).textContent =
                `$${low.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;

            // Update average if element exists
            const avgEl = document.getElementById(`avg-${timeframe}`);
            if (avgEl) {
                avgEl.textContent =
                    `$${avg.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
            }
        }

        // WebSocket for real-time updates
        const ws = new WebSocket('wss://ws-feed.exchange.coinbase.com');

        ws.onopen = () => {
            ws.send(JSON.stringify({
                type: 'subscribe',
                product_ids: ['BTC-USD'],
                channels: ['ticker']
            }));
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'ticker' && data.price) {
                const price = parseFloat(data.price);
                const now = Math.floor(Date.now() / 1000);

                // Update each timeframe
                Object.keys(chartConfigs).forEach(key => {
                    const pData = priceData[key];
                    const config = chartConfigs[key];

                    // Add new data point
                    if (pData.timestamps.length === 0 ||
                        now - pData.timestamps[pData.timestamps.length - 1] >= config.granularity) {
                        pData.timestamps.push(now);
                        pData.prices.push(price);
                        pData.volumes.push(0);

                        // Keep only the required number of points
                        if (pData.timestamps.length > config.points) {
                            pData.timestamps.shift();
                            pData.prices.shift();
                            pData.volumes.shift();
                        }

                        updateChart(key);
                        updateStats(key);
                    }
                });
            }
        };

        // Initialize with historical data
        Object.keys(chartConfigs).forEach(key => {
            fetchHistoricalData(key);
        });

        // Refresh historical data periodically
        setInterval(() => {
            Object.keys(chartConfigs).forEach(key => {
                fetchHistoricalData(key);
            });
        }, 60000); // Refresh every minute
    </script>
</body>
</html>
