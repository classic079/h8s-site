<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Coinbase Stalker — Mobile</title>
<style>
  :root{
    --bg:#0a0a0a; --panel:#101010; --ink:#0f0f0f;
    --text:#e9fef7; --muted:#c8d6cf; --ring:rgba(255,255,255,.08);
    --up:#2dd4bf; --down:#f59e0b;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
  .wrap{max-width:760px;margin:0 auto;padding:10px 10px 60px;display:flex;flex-direction:column;gap:10px}

  .card{background:var(--panel);border-radius:16px;box-shadow:0 0 0 1px var(--ring)}
  .pad{padding:14px}

  /* Header */
  .live{display:flex;flex-direction:column;gap:8px;align-items:center;text-align:center}
  .price{font-weight:900;line-height:1;font-size:clamp(28px,7vw,42px)}
  .price.up{color:var(--up)} .price.down{color:var(--down)}
  .chips{display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
  .chip{border:1px solid var(--ring);border-radius:999px;padding:6px 10px;font-size:12px}
  .chip.up{color:var(--up)} .chip.down{color:var(--down)} .chip.muted{color:var(--muted)}

  /* Dynamic price chart */
  .dynHead{font-weight:800;margin:8px 0 10px 2px}
  #dyn{width:100%;height:180px;display:block;border-radius:12px}

  /* Volume */
  .volHead{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .legend{display:flex;gap:12px;align-items:center}
  .dot{width:12px;height:12px;border-radius:3px;display:inline-block;margin-right:6px}
  .dot.up{background:var(--up)} .dot.down{background:var(--down)}
  #vol{width:100%;height:150px;display:block;border-radius:12px}

  /* Stats tiles */
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .tile{border-radius:14px;background:var(--ink);box-shadow:0 0 0 1px var(--ring);padding:14px}
  .k{font-size:12px;color:var(--muted);margin-bottom:6px}
  .v{font-size:20px;font-weight:800;letter-spacing:.2px}
  .v.small{font-size:18px}
  .hl{display:flex;flex-direction:column;line-height:1.15}
  .good{color:var(--up)} .bad{color:var(--down)}

  /* Connection indicator */
  .conn{position:fixed;left:12px;bottom:12px;font-size:12px;padding:6px 10px;border-radius:999px;
        border:1px solid var(--ring);background:var(--panel);z-index:50}
  .conn.ok{color:var(--up)} .conn.warn{color:#fbbf24} .conn.err{color:#fb7185}
</style>
</head>
<body>
<div class="wrap">
  <section class="card pad">
    <div class="live">
      <div id="price" class="price">$—</div>
      <div class="chips">
        <span id="chip10" class="chip muted">10m Δ —</span>
        <span id="chipHL" class="chip">H/L —</span>
        <span id="chipVol" class="chip">24h Vol —</span>
      </div>
      <div class="dynHead">Dynamic price (1h → live 10m)</div>
      <canvas id="dyn"></canvas>
    </div>
  </section>

  <section class="card pad">
    <div class="volHead">
      <div style="font-weight:800;font-size:22px">Per-minute volume (10m, <b>₿</b>)</div>
      <div class="legend">
        <span><i class="dot up"></i>Buys</span>
        <span><i class="dot down"></i>Sells</span>
      </div>
    </div>
    <canvas id="vol"></canvas>
  </section>

  <section class="grid">
    <div class="tile"><div class="k">Trades / min</div><div id="tpm" class="v">—</div></div>
    <div class="tile"><div class="k">Buy ratio (USD)</div><div id="buyRatio" class="v">—</div></div>
    <div class="tile"><div class="k">VWAP</div><div id="vwap" class="v">$—</div></div>
    <div class="tile"><div class="k">High / Low</div><div id="hl" class="v hl"><span>—</span><span>—</span></div></div>
    <div class="tile"><div class="k">Range</div><div id="range" class="v small">—</div></div>
    <div class="tile"><div class="k">Avg / Median (USD)</div><div id="avgMed" class="v small">—</div></div>
  </section>
</div>
<span id="conn" class="conn warn">Connecting…</span>
<script>
/* Coinbase websocket mobile */
const $=s=>document.querySelector(s);
const fmtUSD=new Intl.NumberFormat(undefined,{style:'currency',currency:'USD',maximumFractionDigits:2});
const fmtUSD0=new Intl.NumberFormat(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0});
const pct2=new Intl.NumberFormat(undefined,{maximumFractionDigits:2});
const btc2=v=>`₿${(+v).toFixed(2)}`;
const css=n=>getComputedStyle(document.documentElement).getPropertyValue(n).trim();
const priceEl=$('#price'), chip10=$('#chip10'), chipHL=$('#chipHL'), chipVol=$('#chipVol');
const tpmEl=$('#tpm'), buyEl=$('#buyRatio'), vwapEl=$('#vwap'), hlEl=$('#hl'), rangeEl=$('#range'), avgMedEl=$('#avgMed');
const connEl=$('#conn');
const dyn=$('#dyn'), dctx=dyn.getContext('2d',{desynchronized:true});
const vol=$('#vol'), vctx=vol.getContext('2d',{desynchronized:true});
function sizeCanvas(c,ctx){const dpr=Math.max(1,Math.min(devicePixelRatio||1,3));c.width=c.clientWidth*dpr;c.height=c.clientHeight*dpr;ctx.setTransform(dpr,0,0,dpr,0,0);}
let ws,trades10=[],seriesDyn=[],lastPrice=null;const MS10=600000;
function conn(state,msg){connEl.classList.remove('ok','warn','err');connEl.classList.add(state==='ok'?'ok':state==='err'?'err':'warn');connEl.textContent=msg;}
function startWS(){try{ws&&ws.close()}catch{};ws=new WebSocket('wss://ws-feed.exchange.coinbase.com');conn('warn','Connecting…');ws.onopen=()=>ws.send(JSON.stringify({type:'subscribe',product_ids:['BTC-USD'],channels:['matches']}));ws.onmessage=e=>{conn('ok','Live');try{const m=JSON.parse(e.data);if(m.type==='match'){ingest(+m.price,+m.size,(m.side||'buy').toLowerCase(),new Date(m.time).getTime());}}catch{}};ws.onclose=()=>setTimeout(startWS,1500);}function ingest(p,s,side,t){if(lastPrice){priceEl.classList.remove('up','down');priceEl.classList.add(p>lastPrice?'up':'down');}lastPrice=p;priceEl.textContent=fmtUSD.format(p);seriesDyn.push({t,p});trades10.push({t,p,s,side});const now=Date.now();seriesDyn=seriesDyn.filter(v=>v.t>now-3600000);trades10=trades10.filter(v=>v.t>now-MS10);drawDyn();drawVol();}
function drawDyn(){sizeCanvas(dyn,dctx);const w=dyn.clientWidth,h=dyn.clientHeight;dctx.clearRect(0,0,w,h);if(seriesDyn.length<2)return;const min=Math.min(...seriesDyn.map(x=>x.p)),max=Math.max(...seriesDyn.map(x=>x.p)),range=max-min;const avg=seriesDyn.reduce((a,x)=>a+x.p,0)/seriesDyn.length;const up=css('--up'),dn=css('--down');const pad=10,xPad=34;dctx.strokeStyle='rgba(255,255,255,.06)';for(let i=1;i<=4;i++){const y=pad+(h-2*pad)/5*i;dctx.beginPath();dctx.moveTo(pad+xPad,y);dctx.lineTo(w-pad,y);dctx.stroke();}dctx.font='12px system-ui';dctx.fillStyle='rgba(255,255,255,.85)';dctx.textBaseline='middle';dctx.fillText(fmtUSD0.format(max),pad+6,pad+10);dctx.fillText(fmtUSD0.format(avg),pad+6,h/2);dctx.fillText(fmtUSD0.format(min),pad+6,h-pad-10);dctx.lineWidth=2;for(let i=1;i<seriesDyn.length;i++){const p0=seriesDyn[i-1].p,p1=seriesDyn[i].p;if(!isFinite(p0)||!isFinite(p1))continue;const x0=pad+xPad+((i-1)/(seriesDyn.length-1))*(w-2*pad-xPad),x1=pad+xPad+(i/(seriesDyn.length-1))*(w-2*pad-xPad);const y0=pad+(h-2*pad)-((p0-min)/range)*(h-2*pad),y1=pad+(h-2*pad)-((p1-min)/range)*(h-2*pad);dctx.strokeStyle=(p1>=avg)?up:dn;dctx.beginPath();dctx.moveTo(x0,y0);dctx.lineTo(x1,y1);dctx.stroke();}}
function bins10(){const start=Date.now()-600000;const bins=Array.from({length:10},(_,i)=>({buy:0,sell:0}));for(const t of trades10){const idx=Math.floor((t.t-(Date.now()-600000))/60000);if(idx>=0&&idx<10){if(t.side==='buy')bins[idx].buy+=t.s;else bins[idx].sell+=t.s;}}return bins;}
function drawVol(){sizeCanvas(vol,vctx);const w=vol.clientWidth,h=vol.clientHeight;vctx.clearRect(0,0,w,h);const up=css('--up'),dn=css('--down');const bins=bins10();const max=Math.max(1,...bins.map(b=>b.buy+b.sell));const padX=30,chartH=h-20,step=(w-padX*2)/bins.length,barW=step*0.6;const MIN_BTC=0.25;for(let i=0;i<bins.length;i++){const b=bins[i],x=padX+i*step+step/2,tot=b.buy+b.sell;if(tot<0.01)continue;const bh=(tot/max)*chartH;vctx.fillStyle=dn;vctx.fillRect(x-barW/2,h-bh*(b.sell/tot),barW,bh*(b.sell/tot));vctx.fillStyle=up;vctx.fillRect(x-barW/2,h-bh,barW,bh*(b.buy/tot));vctx.fillStyle='rgba(255,255,255,.9)';vctx.font='11px system-ui';vctx.textAlign='center';vctx.fillText(btc2(tot),x,h-bh-6);if(tot>=MIN_BTC){const diff=b.buy-b.sell;vctx.fillStyle=(diff>=0?up:dn);vctx.fillText(`${diff>=0?'+':''}${diff.toFixed(2)}`,x,h-bh/2);}}}
startWS();drawDyn();drawVol();</script>
</body>
</html>
